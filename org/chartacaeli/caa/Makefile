ifeq ($(OS),Windows_NT)
	winos := 1
else
	linos := 1
endif

# AA+ V2.21
DST = aaplus
JNI = caa

PKG = org.chartacaeli.$(JNI)

# top-level directory is current minus package (e.g. /foo/bar/hot minus bar.hot yields /foo)
topdir = $(subst $(subst .,/,$(PKG)),,$(CURDIR))
srcdir = src
tmpdir = tmp

AAZIP = $(DST).zip
AAURL = http://www.naughter.com/download/$(AAZIP)
ifdef winos
AADLL = $(DST).dll
AAEXE = AATest.exe

CAADLL = $(JNI).dll
else
AADLL = lib$(DST).so
AAEXE = AATest

CAADLL = lib$(JNI).so
endif

.PHONY: all clean lclean rclean tidy
.SUFFIXES: .cxx .dll .so

vpath %.cpp $(srcdir)
vpath %.cxx $(tmpdir)

# C++ source files in $(AAZIP)
AADLLSRC = \
	$(srcdir)/AAAberration.cpp \
	$(srcdir)/AAAngularSeparation.cpp \
	$(srcdir)/AABinaryStar.cpp \
	$(srcdir)/AACoordinateTransformation.cpp \
	$(srcdir)/AADate.cpp \
	$(srcdir)/AADiameters.cpp \
	$(srcdir)/AADynamicalTime.cpp \
	$(srcdir)/AAEarth.cpp \
	$(srcdir)/AAEaster.cpp \
	$(srcdir)/AAEclipses.cpp \
	$(srcdir)/AAEclipticalElements.cpp \
	$(srcdir)/AAElementsPlanetaryOrbit.cpp \
	$(srcdir)/AAElliptical.cpp \
	$(srcdir)/AAELP2000.cpp \
	$(srcdir)/AAELPMPP02.cpp \
	$(srcdir)/AAEquationOfTime.cpp \
	$(srcdir)/AAEquinoxesAndSolstices.cpp \
	$(srcdir)/AAEquinoxesAndSolstices2.cpp \
	$(srcdir)/AAFK5.cpp \
	$(srcdir)/AAGalileanMoons.cpp \
	$(srcdir)/AAGlobe.cpp \
	$(srcdir)/AAIlluminatedFraction.cpp \
	$(srcdir)/AAInterpolate.cpp \
	$(srcdir)/AAJewishCalendar.cpp \
	$(srcdir)/AAJupiter.cpp \
	$(srcdir)/AAKepler.cpp \
	$(srcdir)/AAMars.cpp \
	$(srcdir)/AAMercury.cpp \
	$(srcdir)/AAMoon.cpp \
	$(srcdir)/AAMoonIlluminatedFraction.cpp \
	$(srcdir)/AAMoonMaxDeclinations.cpp \
	$(srcdir)/AAMoonMaxDeclinations2.cpp \
	$(srcdir)/AAMoonNodes.cpp \
	$(srcdir)/AAMoonNodes2.cpp \
	$(srcdir)/AAMoonPerigeeApogee.cpp \
	$(srcdir)/AAMoonPerigeeApogee2.cpp \
	$(srcdir)/AAMoonPhases.cpp \
	$(srcdir)/AAMoonPhases2.cpp \
	$(srcdir)/AAMoslemCalendar.cpp \
	$(srcdir)/AANearParabolic.cpp \
	$(srcdir)/AANeptune.cpp \
	$(srcdir)/AANodes.cpp \
	$(srcdir)/AANutation.cpp \
	$(srcdir)/AAParabolic.cpp \
	$(srcdir)/AAParallactic.cpp \
	$(srcdir)/AAParallax.cpp \
	$(srcdir)/AAPhysicalJupiter.cpp \
	$(srcdir)/AAPhysicalMars.cpp \
	$(srcdir)/AAPhysicalMoon.cpp \
	$(srcdir)/AAPhysicalSun.cpp \
	$(srcdir)/AAPlanetaryPhenomena.cpp \
	$(srcdir)/AAPlanetaryPhenomena2.cpp \
	$(srcdir)/AAPlanetPerihelionAphelion.cpp \
	$(srcdir)/AAPlanetPerihelionAphelion2.cpp \
	$(srcdir)/AAPluto.cpp \
	$(srcdir)/AAPrecession.cpp \
	$(srcdir)/AARefraction.cpp \
	$(srcdir)/AARiseTransitSet.cpp \
	$(srcdir)/AARiseTransitSet2.cpp \
	$(srcdir)/AASaturn.cpp \
	$(srcdir)/AASaturnMoons.cpp \
	$(srcdir)/AASaturnRings.cpp \
	$(srcdir)/AASidereal.cpp \
	$(srcdir)/AAStellarMagnitudes.cpp \
	$(srcdir)/AASun.cpp \
	$(srcdir)/AAUranus.cpp \
	$(srcdir)/AAVenus.cpp \
	$(srcdir)/AAVSOP87.cpp \
	$(srcdir)/AAVSOP87_EMB.cpp \
	$(srcdir)/AAVSOP87_JUP.cpp \
	$(srcdir)/AAVSOP87_MAR.cpp \
	$(srcdir)/AAVSOP87_MER.cpp \
	$(srcdir)/AAVSOP87_NEP.cpp \
	$(srcdir)/AAVSOP87_SAT.cpp \
	$(srcdir)/AAVSOP87_URA.cpp \
	$(srcdir)/AAVSOP87_VEN.cpp \
	$(srcdir)/AAVSOP87A_EAR.cpp \
	$(srcdir)/AAVSOP87A_EMB.cpp \
	$(srcdir)/AAVSOP87A_JUP.cpp \
	$(srcdir)/AAVSOP87A_MAR.cpp \
	$(srcdir)/AAVSOP87A_MER.cpp \
	$(srcdir)/AAVSOP87A_NEP.cpp \
	$(srcdir)/AAVSOP87A_SAT.cpp \
	$(srcdir)/AAVSOP87A_URA.cpp \
	$(srcdir)/AAVSOP87A_VEN.cpp \
	$(srcdir)/AAVSOP87B_EAR.cpp \
	$(srcdir)/AAVSOP87B_JUP.cpp \
	$(srcdir)/AAVSOP87B_MAR.cpp \
	$(srcdir)/AAVSOP87B_MER.cpp \
	$(srcdir)/AAVSOP87B_NEP.cpp \
	$(srcdir)/AAVSOP87B_SAT.cpp \
	$(srcdir)/AAVSOP87B_URA.cpp \
	$(srcdir)/AAVSOP87B_VEN.cpp \
	$(srcdir)/AAVSOP87C_EAR.cpp \
	$(srcdir)/AAVSOP87C_JUP.cpp \
	$(srcdir)/AAVSOP87C_MAR.cpp \
	$(srcdir)/AAVSOP87C_MER.cpp \
	$(srcdir)/AAVSOP87C_NEP.cpp \
	$(srcdir)/AAVSOP87C_SAT.cpp \
	$(srcdir)/AAVSOP87C_URA.cpp \
	$(srcdir)/AAVSOP87C_VEN.cpp \
	$(srcdir)/AAVSOP87D_EAR.cpp \
	$(srcdir)/AAVSOP87D_JUP.cpp \
	$(srcdir)/AAVSOP87D_MAR.cpp \
	$(srcdir)/AAVSOP87D_MER.cpp \
	$(srcdir)/AAVSOP87D_NEP.cpp \
	$(srcdir)/AAVSOP87D_SAT.cpp \
	$(srcdir)/AAVSOP87D_URA.cpp \
	$(srcdir)/AAVSOP87D_VEN.cpp \
	$(srcdir)/AAVSOP87E_EAR.cpp \
	$(srcdir)/AAVSOP87E_JUP.cpp \
	$(srcdir)/AAVSOP87E_MAR.cpp \
	$(srcdir)/AAVSOP87E_MER.cpp \
	$(srcdir)/AAVSOP87E_NEP.cpp \
	$(srcdir)/AAVSOP87E_SAT.cpp \
	$(srcdir)/AAVSOP87E_SUN.cpp \
	$(srcdir)/AAVSOP87E_URA.cpp \
	$(srcdir)/AAVSOP87E_VEN.cpp \

AADLLOBJ = $(patsubst $(srcdir)/%.cpp,%.o,$(AADLLSRC))

$(AADLLOBJ): | $(srcdir)

# default target
$(srcdir): $(AAZIP)
	unzip -o `basename $(AAURL)` -d $@

# JNI code generated by CXXWRAP
CAADLLSRC = \
	CAA2DCoordinate_jni.cxx \
	CAA3DCoordinate_jni.cxx \
	CAAAberration_jni.cxx \
	CAAAngularSeparation_jni.cxx \
	CAABinaryStarDetails_jni.cxx \
	CAABinaryStar_jni.cxx \
	CAACoordinateTransformation_jni.cxx \
	CAACalendarDate_jni.cxx \
	CAADate_jni.cxx \
	CAADiameters_jni.cxx \
	CAADynamicalTime_jni.cxx \
	CAAEarth_jni.cxx \
	CAAEasterDetails_jni.cxx \
	CAAEaster_jni.cxx \
	CAASolarEclipseDetails_jni.cxx \
	CAALunarEclipseDetails_jni.cxx \
	CAAEclipses_jni.cxx \
	CAAEclipticalElementDetails_jni.cxx \
	CAAEclipticalElements_jni.cxx \
	CAAElementsPlanetaryOrbit_jni.cxx \
	CAAEllipticalObjectElements_jni.cxx \
	CAAEllipticalPlanetaryDetails_jni.cxx \
	CAAEllipticalObjectDetails_jni.cxx \
	CAAElliptical_jni.cxx \
	CAAELP2000_jni.cxx \
	CAAELPMPP02_jni.cxx \
	CAAEquationOfTime_jni.cxx \
	CAAEquinoxesAndSolstices_jni.cxx \
	CAAEquinoxSolsticeDetails2_jni.cxx \
	CAAEquinoxesAndSolstices2_jni.cxx \
	CAAFK5_jni.cxx \
	CAAGalileanMoonDetail_jni.cxx \
	CAAGalileanMoonsDetails_jni.cxx \
	CAAGalileanMoons_jni.cxx \
	CAAGlobe_jni.cxx \
	CAAIlluminatedFraction_jni.cxx \
	CAAInterpolate_jni.cxx \
	CAAJewishCalendar_jni.cxx \
	CAAJupiter_jni.cxx \
	CAAKepler_jni.cxx \
	CAAMars_jni.cxx \
	CAAMercury_jni.cxx \
	CAAMoon_jni.cxx \
	CAAMoonIlluminatedFraction_jni.cxx \
	CAAMoonMaxDeclinations_jni.cxx \
	CAAMoonMaxDeclinationsDetails2_jni.cxx \
	CAAMoonMaxDeclinations2_jni.cxx \
	CAAMoonNodes_jni.cxx \
	CAAMoonNodesDetails2_jni.cxx \
	CAAMoonNodes2_jni.cxx \
	CAAMoonPerigeeApogee_jni.cxx \
	CAAMoonPerigeeApogeeDetails2_jni.cxx \
	CAAMoonPerigeeApogee2_jni.cxx \
	CAAMoonPhases_jni.cxx \
	CAAMoonPhasesDetails2_jni.cxx \
	CAAMoonPhases2_jni.cxx \
	CAAMoslemCalendar_jni.cxx \
	CAANearParabolicObjectElements_jni.cxx \
	CAANearParabolicObjectDetails_jni.cxx \
	CAANearParabolic_jni.cxx \
	CAANeptune_jni.cxx \
	CAANodeObjectDetails_jni.cxx \
	CAANodes_jni.cxx \
	CAANutation_jni.cxx \
	CAAParabolicObjectElements_jni.cxx \
	CAAParabolicObjectDetails_jni.cxx \
	CAAParabolic_jni.cxx \
	CAAParallactic_jni.cxx \
	CAATopocentricEclipticDetails_jni.cxx \
	CAAParallax_jni.cxx \
	CAAPhysicalJupiterDetails_jni.cxx \
	CAAPhysicalJupiter_jni.cxx \
	CAAPhysicalMarsDetails_jni.cxx \
	CAAPhysicalMars_jni.cxx \
	CAAPhysicalMoonDetails_jni.cxx \
	CAASelenographicMoonDetails_jni.cxx \
	CAAPhysicalMoon_jni.cxx \
	CAAPhysicalSunDetails_jni.cxx \
	CAAPhysicalSun_jni.cxx \
	CAAPlanetaryPhenomena_jni.cxx \
	CAAPlanetaryPhenomenaDetails2_jni.cxx \
	CAAPlanetaryPhenomena2_jni.cxx \
	CAAPlanetPerihelionAphelion_jni.cxx \
	CAAPlanetPerihelionAphelionDetails2_jni.cxx \
	CAAPlanetPerihelionAphelion2_jni.cxx \
	CAAPluto_jni.cxx \
	CAAPrecession_jni.cxx \
	CAARefraction_jni.cxx \
	CAARiseTransitSetDetails_jni.cxx \
	CAARiseTransitSet_jni.cxx \
	CAARiseTransitSetDetails2_jni.cxx \
	CAARiseTransitSet2_jni.cxx \
	CAASaturn_jni.cxx \
	CAASaturnMoonDetail_jni.cxx \
	CAASaturnMoonsDetails_jni.cxx \
	CAASaturnMoons_jni.cxx \
	CAASaturnRingDetails_jni.cxx \
	CAASaturnRings_jni.cxx \
	CAASidereal_jni.cxx \
	CAAStellarMagnitudes_jni.cxx \
	CAASun_jni.cxx \
	CAAUranus_jni.cxx \
	CAAVenus_jni.cxx \
	CVSOP87_jni.cxx \
	CAAVSOP87_EMB_jni.cxx \
	CAAVSOP87_Jupiter_jni.cxx \
	CAAVSOP87_Mars_jni.cxx \
	CAAVSOP87_Mercury_jni.cxx \
	CAAVSOP87_Neptune_jni.cxx \
	CAAVSOP87_Saturn_jni.cxx \
	CAAVSOP87_Uranus_jni.cxx \
	CAAVSOP87_Venus_jni.cxx \
	CAAVSOP87A_Earth_jni.cxx \
	CAAVSOP87A_EMB_jni.cxx \
	CAAVSOP87A_Jupiter_jni.cxx \
	CAAVSOP87A_Mars_jni.cxx \
	CAAVSOP87A_Mercury_jni.cxx \
	CAAVSOP87A_Neptune_jni.cxx \
	CAAVSOP87A_Saturn_jni.cxx \
	CAAVSOP87A_Uranus_jni.cxx \
	CAAVSOP87A_Venus_jni.cxx \
	CAAVSOP87B_Earth_jni.cxx \
	CAAVSOP87B_Jupiter_jni.cxx \
	CAAVSOP87B_Mars_jni.cxx \
	CAAVSOP87B_Mercury_jni.cxx \
	CAAVSOP87B_Neptune_jni.cxx \
	CAAVSOP87B_Saturn_jni.cxx \
	CAAVSOP87B_Uranus_jni.cxx \
	CAAVSOP87B_Venus_jni.cxx \
	CAAVSOP87C_Earth_jni.cxx \
	CAAVSOP87C_Jupiter_jni.cxx \
	CAAVSOP87C_Mars_jni.cxx \
	CAAVSOP87C_Mercury_jni.cxx \
	CAAVSOP87C_Neptune_jni.cxx \
	CAAVSOP87C_Saturn_jni.cxx \
	CAAVSOP87C_Uranus_jni.cxx \
	CAAVSOP87C_Venus_jni.cxx \
	CAAVSOP87D_Earth_jni.cxx \
	CAAVSOP87D_Jupiter_jni.cxx \
	CAAVSOP87D_Mars_jni.cxx \
	CAAVSOP87D_Mercury_jni.cxx \
	CAAVSOP87D_Neptune_jni.cxx \
	CAAVSOP87D_Saturn_jni.cxx \
	CAAVSOP87D_Uranus_jni.cxx \
	CAAVSOP87D_Venus_jni.cxx \
	CAAVSOP87E_Earth_jni.cxx \
	CAAVSOP87E_Jupiter_jni.cxx \
	CAAVSOP87E_Mars_jni.cxx \
	CAAVSOP87E_Mercury_jni.cxx \
	CAAVSOP87E_Neptune_jni.cxx \
	CAAVSOP87E_Saturn_jni.cxx \
	CAAVSOP87E_Sun_jni.cxx \
	CAAVSOP87E_Uranus_jni.cxx \
	CAAVSOP87E_Venus_jni.cxx \

CAADLLOBJ = $(patsubst %.cxx,%.o,$(CAADLLSRC))

# dependencies of JNI code from class definition files
CAA2DCoordinate_jni.cxx: $(tmpdir)/AA2DCoordinate.h
CAA3DCoordinate_jni.cxx: $(tmpdir)/AA3DCoordinate.h
CAAAberration_jni.cxx: $(tmpdir)/AAAberration.h
CAAAngularSeparation_jni.cxx: $(tmpdir)/AAAngularSeparation.h
CAABinaryStarDetails_jni.cxx: $(tmpdir)/AABinaryStar.h
CAABinaryStar_jni.cxx: $(tmpdir)/AABinaryStar.h
CAACoordinateTransformation_jni.cxx: $(tmpdir)/AACoordinateTransformation.h
CAACalendarDate_jni.cxx: $(tmpdir)/AADate.h
CAADate_jni.cxx: $(tmpdir)/AADate.h
CAADiameters_jni.cxx: $(tmpdir)/AADiameters.h
CAADynamicalTime_jni.cxx: $(tmpdir)/AADynamicalTime.h
CAAEarth_jni.cxx: $(tmpdir)/AAEarth.h
CAAEasterDetails_jni.cxx: $(tmpdir)/AAEaster.h
CAAEaster_jni.cxx: $(tmpdir)/AAEaster.h
CAASolarEclipseDetails_jni.cxx: $(tmpdir)/AAEclipses.h
CAALunarEclipseDetails_jni.cxx: $(tmpdir)/AAEclipses.h
CAAEclipses_jni.cxx: $(tmpdir)/AAEclipses.h
CAAEclipticalElementDetails_jni.cxx: $(tmpdir)/AAEclipticalElements.h
CAAEclipticalElements_jni.cxx: $(tmpdir)/AAEclipticalElements.h
CAAElementsPlanetaryOrbit_jni.cxx: $(tmpdir)/AAElementsPlanetaryOrbit.h
CAAEllipticalObjectElements_jni.cxx: $(tmpdir)/AAElliptical.h
CAAEllipticalPlanetaryDetails_jni.cxx: $(tmpdir)/AAElliptical.h
CAAEllipticalObjectDetails_jni.cxx: $(tmpdir)/AAElliptical.h
CAAElliptical_jni.cxx: $(tmpdir)/AAElliptical.h
CAAELP2000_jni.cxx: $(tmpdir)/AAELP2000.h
CAAELPMPP02_jni.cxx: $(tmpdir)/AAELPMPP02.h
CAAEquationOfTime_jni.cxx: $(tmpdir)/AAEquationOfTime.h
CAAEquinoxesAndSolstices_jni.cxx: $(tmpdir)/AAEquinoxesAndSolstices.h
CAAEquinoxSolsticeDetails2_jni.cxx: $(tmpdir)/AAEquinoxesAndSolstices2.h
CAAEquinoxesAndSolstices2_jni.cxx: $(tmpdir)/AAEquinoxesAndSolstices2.h
CAAFK5_jni.cxx: $(tmpdir)/AAFK5.h
CAAGalileanMoonDetail_jni.cxx: $(tmpdir)/AAGalileanMoons.h
CAAGalileanMoonsDetails_jni.cxx: $(tmpdir)/AAGalileanMoons.h
CAAGalileanMoons_jni.cxx: $(tmpdir)/AAGalileanMoons.h
CAAGlobe_jni.cxx: $(tmpdir)/AAGlobe.h
CAAIlluminatedFraction_jni.cxx: $(tmpdir)/AAIlluminatedFraction.h
CAAInterpolate_jni.cxx: $(tmpdir)/AAInterpolate.h
CAAJewishCalendar_jni.cxx: $(tmpdir)/AAJewishCalendar.h
CAAJupiter_jni.cxx: $(tmpdir)/AAJupiter.h
CAAKepler_jni.cxx: $(tmpdir)/AAKepler.h
CAAMars_jni.cxx: $(tmpdir)/AAMars.h
CAAMercury_jni.cxx: $(tmpdir)/AAMercury.h
CAAMoon_jni.cxx: $(tmpdir)/AAMoon.h
CAAMoonIlluminatedFraction_jni.cxx: $(tmpdir)/AAMoonIlluminatedFraction.h
CAAMoonMaxDeclinations_jni.cxx: $(tmpdir)/AAMoonMaxDeclinations.h
CAAMoonMaxDeclinationsDetails2_jni.cxx: $(tmpdir)/AAMoonMaxDeclinations2.h
CAAMoonMaxDeclinations2_jni.cxx: $(tmpdir)/AAMoonMaxDeclinations2.h
CAAMoonNodes_jni.cxx: $(tmpdir)/AAMoonNodes.h
CAAMoonNodesDetails2_jni.cxx: $(tmpdir)/AAMoonNodes2.h
CAAMoonNodes2_jni.cxx: $(tmpdir)/AAMoonNodes2.h
CAAMoonPerigeeApogee_jni.cxx: $(tmpdir)/AAMoonPerigeeApogee.h
CAAMoonPerigeeApogeeDetails2_jni.cxx: $(tmpdir)/AAMoonPerigeeApogee2.h
CAAMoonPerigeeApogee2_jni.cxx: $(tmpdir)/AAMoonPerigeeApogee2.h
CAAMoonPhases_jni.cxx: $(tmpdir)/AAMoonPhases.h
CAAMoonPhasesDetails2_jni.cxx: $(tmpdir)/AAMoonPhases2.h
CAAMoonPhases2_jni.cxx: $(tmpdir)/AAMoonPhases2.h
CAAMoslemCalendar_jni.cxx: $(tmpdir)/AAMoslemCalendar.h
CAANearParabolicObjectElements_jni.cxx: $(tmpdir)/AANearParabolic.h
CAANearParabolicObjectDetails_jni.cxx: $(tmpdir)/AANearParabolic.h
CAANearParabolic_jni.cxx: $(tmpdir)/AANearParabolic.h
CAANeptune_jni.cxx: $(tmpdir)/AANeptune.h
CAANodeObjectDetails_jni.cxx: $(tmpdir)/AANodes.h
CAANodes_jni.cxx: $(tmpdir)/AANodes.h
CAANutation_jni.cxx: $(tmpdir)/AANutation.h
CAAParabolicObjectElements_jni.cxx: $(tmpdir)/AAParabolic.h
CAAParabolicObjectDetails_jni.cxx: $(tmpdir)/AAParabolic.h
CAAParabolic_jni.cxx: $(tmpdir)/AAParabolic.h
CAAParallactic_jni.cxx: $(tmpdir)/AAParallactic.h
CAATopocentricEclipticDetails_jni.cxx: $(tmpdir)/AAParallax.h
CAAParallax_jni.cxx: $(tmpdir)/AAParallax.h
CAAPhysicalJupiterDetails_jni.cxx: $(tmpdir)/AAPhysicalJupiter.h
CAAPhysicalJupiter_jni.cxx: $(tmpdir)/AAPhysicalJupiter.h
CAAPhysicalMarsDetails_jni.cxx: $(tmpdir)/AAPhysicalMars.h
CAAPhysicalMars_jni.cxx: $(tmpdir)/AAPhysicalMars.h
CAAPhysicalMoonDetails_jni.cxx: $(tmpdir)/AAPhysicalMoon.h
CAASelenographicMoonDetails_jni.cxx: $(tmpdir)/AAPhysicalMoon.h
CAAPhysicalMoon_jni.cxx: $(tmpdir)/AAPhysicalMoon.h
CAAPhysicalSunDetails_jni.cxx: $(tmpdir)/AAPhysicalSun.h
CAAPhysicalSun_jni.cxx: $(tmpdir)/AAPhysicalSun.h
CAAPlanetaryPhenomena_jni.cxx: $(tmpdir)/AAPlanetaryPhenomena.h
CAAPlanetaryPhenomenaDetails2_jni.cxx: $(tmpdir)/AAPlanetaryPhenomena2.h
CAAPlanetaryPhenomena2_jni.cxx: $(tmpdir)/AAPlanetaryPhenomena2.h
CAAPlanetPerihelionAphelion_jni.cxx: $(tmpdir)/AAPlanetPerihelionAphelion.h
CAAPlanetPerihelionAphelionDetails2_jni.cxx: $(tmpdir)/AAPlanetPerihelionAphelion2.h
CAAPlanetPerihelionAphelion2_jni.cxx: $(tmpdir)/AAPlanetPerihelionAphelion2.h
CAAPluto_jni.cxx: $(tmpdir)/AAPluto.h
CAAPrecession_jni.cxx: $(tmpdir)/AAPrecession.h
CAARefraction_jni.cxx: $(tmpdir)/AARefraction.h
CAARiseTransitSetDetails_jni.cxx: $(tmpdir)/AARiseTransitSet.h
CAARiseTransitSet_jni.cxx: $(tmpdir)/AARiseTransitSet.h
CAARiseTransitSetDetails2_jni.cxx: $(tmpdir)/AARiseTransitSet2.h
CAARiseTransitSet2_jni.cxx: $(tmpdir)/AARiseTransitSet2.h
CAASaturn_jni.cxx: $(tmpdir)/AASaturn.h
CAASaturnMoonDetail_jni.cxx: $(tmpdir)/AASaturnMoons.h
CAASaturnMoonsDetails_jni.cxx: $(tmpdir)/AASaturnMoons.h
CAASaturnMoons_jni.cxx: $(tmpdir)/AASaturnMoons.h
CAASaturnRingDetails_jni.cxx: $(tmpdir)/AASaturnRings.h
CAASaturnRings_jni.cxx: $(tmpdir)/AASaturnRings.h
CAASidereal_jni.cxx: $(tmpdir)/AASidereal.h
CAAStellarMagnitudes_jni.cxx: $(tmpdir)/AAStellarMagnitudes.h
CAASun_jni.cxx: $(tmpdir)/AASun.h
CAAUranus_jni.cxx: $(tmpdir)/AAUranus.h
CAAVenus_jni.cxx: $(tmpdir)/AAVenus.h
CVSOP87_jni.cxx: $(tmpdir)/AAVSOP87.h
CAAVSOP87_EMB_jni.cxx: $(tmpdir)/AAVSOP87_EMB.h
CAAVSOP87_Jupiter_jni.cxx: $(tmpdir)/AAVSOP87_JUP.h
CAAVSOP87_Mars_jni.cxx: $(tmpdir)/AAVSOP87_MAR.h
CAAVSOP87_Mercury_jni.cxx: $(tmpdir)/AAVSOP87_MER.h
CAAVSOP87_Neptune_jni.cxx: $(tmpdir)/AAVSOP87_NEP.h
CAAVSOP87_Saturn_jni.cxx: $(tmpdir)/AAVSOP87_SAT.h
CAAVSOP87_Uranus_jni.cxx: $(tmpdir)/AAVSOP87_URA.h
CAAVSOP87_Venus_jni.cxx: $(tmpdir)/AAVSOP87_VEN.h
CAAVSOP87A_Earth_jni.cxx: $(tmpdir)/AAVSOP87A_EAR.h
CAAVSOP87A_EMB_jni.cxx: $(tmpdir)/AAVSOP87A_EMB.h
CAAVSOP87A_Jupiter_jni.cxx: $(tmpdir)/AAVSOP87A_JUP.h
CAAVSOP87A_Mars_jni.cxx: $(tmpdir)/AAVSOP87A_MAR.h
CAAVSOP87A_Mercury_jni.cxx: $(tmpdir)/AAVSOP87A_MER.h
CAAVSOP87A_Neptune_jni.cxx: $(tmpdir)/AAVSOP87A_NEP.h
CAAVSOP87A_Saturn_jni.cxx: $(tmpdir)/AAVSOP87A_SAT.h
CAAVSOP87A_Uranus_jni.cxx: $(tmpdir)/AAVSOP87A_URA.h
CAAVSOP87A_Venus_jni.cxx: $(tmpdir)/AAVSOP87A_VEN.h
CAAVSOP87B_Earth_jni.cxx: $(tmpdir)/AAVSOP87B_EAR.h
CAAVSOP87B_Jupiter_jni.cxx: $(tmpdir)/AAVSOP87B_JUP.h
CAAVSOP87B_Mars_jni.cxx: $(tmpdir)/AAVSOP87B_MAR.h
CAAVSOP87B_Mercury_jni.cxx: $(tmpdir)/AAVSOP87B_MER.h
CAAVSOP87B_Neptune_jni.cxx: $(tmpdir)/AAVSOP87B_NEP.h
CAAVSOP87B_Saturn_jni.cxx: $(tmpdir)/AAVSOP87B_SAT.h
CAAVSOP87B_Uranus_jni.cxx: $(tmpdir)/AAVSOP87B_URA.h
CAAVSOP87B_Venus_jni.cxx: $(tmpdir)/AAVSOP87B_VEN.h
CAAVSOP87C_Earth_jni.cxx: $(tmpdir)/AAVSOP87C_EAR.h
CAAVSOP87C_Jupiter_jni.cxx: $(tmpdir)/AAVSOP87C_JUP.h
CAAVSOP87C_Mars_jni.cxx: $(tmpdir)/AAVSOP87C_MAR.h
CAAVSOP87C_Mercury_jni.cxx: $(tmpdir)/AAVSOP87C_MER.h
CAAVSOP87C_Neptune_jni.cxx: $(tmpdir)/AAVSOP87C_NEP.h
CAAVSOP87C_Saturn_jni.cxx: $(tmpdir)/AAVSOP87C_SAT.h
CAAVSOP87C_Uranus_jni.cxx: $(tmpdir)/AAVSOP87C_URA.h
CAAVSOP87C_Venus_jni.cxx: $(tmpdir)/AAVSOP87C_VEN.h
CAAVSOP87D_Earth_jni.cxx: $(tmpdir)/AAVSOP87D_EAR.h
CAAVSOP87D_Jupiter_jni.cxx: $(tmpdir)/AAVSOP87D_JUP.h
CAAVSOP87D_Mars_jni.cxx: $(tmpdir)/AAVSOP87D_MAR.h
CAAVSOP87D_Mercury_jni.cxx: $(tmpdir)/AAVSOP87D_MER.h
CAAVSOP87D_Neptune_jni.cxx: $(tmpdir)/AAVSOP87D_NEP.h
CAAVSOP87D_Saturn_jni.cxx: $(tmpdir)/AAVSOP87D_SAT.h
CAAVSOP87D_Uranus_jni.cxx: $(tmpdir)/AAVSOP87D_URA.h
CAAVSOP87D_Venus_jni.cxx: $(tmpdir)/AAVSOP87D_VEN.h
CAAVSOP87E_Earth_jni.cxx: $(tmpdir)/AAVSOP87E_EAR.h
CAAVSOP87E_Jupiter_jni.cxx: $(tmpdir)/AAVSOP87E_JUP.h
CAAVSOP87E_Mars_jni.cxx: $(tmpdir)/AAVSOP87E_MAR.h
CAAVSOP87E_Mercury_jni.cxx: $(tmpdir)/AAVSOP87E_MER.h
CAAVSOP87E_Neptune_jni.cxx: $(tmpdir)/AAVSOP87E_NEP.h
CAAVSOP87E_Saturn_jni.cxx: $(tmpdir)/AAVSOP87E_SAT.h
CAAVSOP87E_Sun_jni.cxx: $(tmpdir)/AAVSOP87E_SUN.h
CAAVSOP87E_Uranus_jni.cxx: $(tmpdir)/AAVSOP87E_URA.h
CAAVSOP87E_Venus_jni.cxx: $(tmpdir)/AAVSOP87E_VEN.h

# inter-dependencies of class definition files
$(tmpdir)/AACoordinateTransformation.h: $(tmpdir)/AA2DCoordinate.h
$(tmpdir)/AADate.h: $(tmpdir)/AADefines.h
$(tmpdir)/AADiameters.h: $(tmpdir)/AACoordinateTransformation.h $(tmpdir)/AA2DCoordinate.h
$(tmpdir)/AAElliptical.h: $(tmpdir)/AA3DCoordinate.h
$(tmpdir)/AAELP2000.h: $(tmpdir)/AA3DCoordinate.h
$(tmpdir)/AAELPMPP02.h: $(tmpdir)/AA2DCoordinate.h $(tmpdir)/AA3DCoordinate.h
$(tmpdir)/AAEquinoxesAndSolstices2.h: $(tmpdir)/AA2DCoordinate.h
$(tmpdir)/AAFK5.h: $(tmpdir)/AA3DCoordinate.h
$(tmpdir)/AAGalileanMoons.h: $(tmpdir)/AA3DCoordinate.h
$(tmpdir)/AAJewishCalendar.h: $(tmpdir)/AADate.h $(tmpdir)/AADefines.h
$(tmpdir)/AAMoonMaxDeclinations2.h: $(tmpdir)/AA2DCoordinate.h
$(tmpdir)/AAMoonPerigeeApogee2.h: $(tmpdir)/AA2DCoordinate.h
$(tmpdir)/AAMoslemCalendar.h: $(tmpdir)/AADate.h $(tmpdir)/AADefines.h
$(tmpdir)/AANearParabolic.h: $(tmpdir)/AA3DCoordinate.h
$(tmpdir)/AANodes.h: $(tmpdir)/AAElliptical.h $(tmpdir)/AA3DCoordinate.h $(tmpdir)/AAParabolic.h
$(tmpdir)/AAParabolic.h: $(tmpdir)/AA3DCoordinate.h
$(tmpdir)/AAParallax.h: $(tmpdir)/AA2DCoordinate.h
$(tmpdir)/AAPhysicalMoon.h: $(tmpdir)/AACoordinateTransformation.h $(tmpdir)/AA2DCoordinate.h
$(tmpdir)/AAPlanetaryPhenomena2.h: $(tmpdir)/AA2DCoordinate.h
$(tmpdir)/AAPlanetPerihelionAphelion2.h: $(tmpdir)/AA2DCoordinate.h
$(tmpdir)/AAPrecession.h: $(tmpdir)/AACoordinateTransformation.h $(tmpdir)/AA2DCoordinate.h
$(tmpdir)/AARiseTransitSet2.h: $(tmpdir)/AA2DCoordinate.h
$(tmpdir)/AASaturnMoons.h: $(tmpdir)/AA3DCoordinate.h
$(tmpdir)/AASun.h: $(tmpdir)/AA3DCoordinate.h

# internal dependencies of class definition files
$(tmpdir)/AADefines.h:
	ln $(srcdir)/$(@F) $@

$(CAADLLSRC): | $(tmpdir)
	$(CXX) -E $< > $(<F)
	$(CXXWRAP) --verbose \
		--jni --jni-attributes \
		--classpath=$(topdir) \
		--package-prefix=$(PKG) $(<F)
	ln -f $< $(<F)

$(tmpdir):
	mkdir -p $@

$(tmpdir)/%.h: $(srcdir)/%.h
	sed \
		-e 's,\(#.*<array>.*\),//\1,' \
		-e 's,\(std::array.*\),//\1,' \
		-e s,constexpr,const, \
		-e s,noexcept,, \
		-e s,enum..*class,enum, $< > $@

ifdef winos
AATest.o: AATest.cpp
	$(CXX) -DAAPLUS_ELP2000_NO_HIGH_PRECISION -DAAPLUS_NO_ELPMPP02 -std=c++11 -Wall -shared -c $< -o $@

.cpp.o:
	$(CXX) -std=c++17 -Wall -shared -c $< -o $@

.cxx.o:
	$(CXX) -std=c++11 -Wall -shared \
	-I"$(JAVA_HOME)/include" \
	-I"$(JAVA_HOME)/include/win32" \
	-I. -I$(srcdir) \
	-c $< -o $@
else
AATest.o: AATest.cpp
	$(CXX) -DAAPLUS_ELP2000_NO_HIGH_PRECISION -DAAPLUS_NO_ELPMPP02 -std=c++11 -Wall -shared -fPIC -c $< -o $@

.cpp.o:
	$(CXX) -std=c++17 -Wall -shared -fPIC -c $< -o $@

.cxx.o:
	$(CXX) -std=c++11 -Wall -shared -fPIC \
	-I$(JAVA_HOME)/include \
	-I$(JAVA_HOME)/include/linux \
	-I. -I$(srcdir) \
	-c $< -o $@
endif

$(AAZIP):
	wget -q -O $@ $(AAURL)

$(AADLL): $(AADLLOBJ)
	$(CXX) -Wall -shared \
	-o $@ $^

$(AAEXE): AATest.o $(AADLL)
	$(CXX) -o $@ $< -L. -l$(DST)

$(CAADLL): $(AADLL) $(CAADLLOBJ)
	$(CXX) -Wall -shared \
	-o $@ $(CAADLLOBJ) \
	-L. -l$(DST)

all: $(CAADLL)

# compiler objects
clean:
	rm -f *.o
	rm -f [_a-z]*.cxx [_a-z]*.java [_a-z]*.class

# local clean
lclean: clean
	rm -rf $(srcdir)
	rm -f $(subst $(tmpdir)/,,$(wildcard $(tmpdir)/*.h))
	rm -rf $(tmpdir)
	rm -f $(CAADLLSRC)
	rm -f $(subst .cxx,.java,$(CAADLLSRC))
	rm -f $(AADLL) $(CAADLL) $(AAEXE)

# real clean
rclean: lclean
	rm -rf $(AAZIP)

tidy: rclean
